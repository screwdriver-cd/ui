{{#if session.isAuthenticated}}
  {{pipeline-nav pipeline=pipeline}}
{{/if}}

{{info-message message=errorMessage type="warning" icon="exclamation-triangle"}}

<div class="chart-controls">
  <div class="chart-control range-selection">
    <span class="title">Time Range</span>
    {{#bs-button-group
      value=selectedRange
      type="radio"
      onChange=(action "setTimeRange") as |bg|}}
      {{#each timeRanges as |range|}}
        {{#bg.button value=range.value}}{{range.alias}}{{/bg.button}}
      {{/each}}
    {{/bs-button-group}}
  </div>

  <div class="chart-control custom-date-selection">
    <span class="title">Custom Date Range</span>
    {{ember-flatpickr
      clickOpens=true
      dateFormat="m/d/Y"
      date=customRange
      locale="en"
      mode="range"
      onChange=(action (mut dateValues))
      onClose=(action "setCustomRange")
      placeholder="Choose Start & End Date Time"
    }}
  </div>

  {{x-toggle
    size="small"
    theme="material"
    showLabels=true
    value=isUTC
    offLabel="Local"
    onLabel="UTC"
    onToggle=(action (mut isUTC))
  }}

  <div class="chart-control filters-selection">
    {{x-toggle
      size="small"
      theme="material"
      showLabels=true
      value=successOnly
      offLabel=null
      onLabel="Success Only"
      onToggle=(action "toggleSuccessOnly")}}
  </div>
</div>

<div class="chart-pipeline-info">
  <div class="col">
    <span class="measure">{{if measures.total measures.total "N/A"}}</span>
    <br>
    <span class="title">Total Events</span>
  </div>
  <div class="col">
    <span class="measure">
      {{#if measures.total}}
        <span class="passed">{{measures.passed}}</span> / <span class="failed">{{measures.failed}}</span>
      {{else}}
        N/A
      {{/if}}
    </span>
    <br>
    <span class="title">Passed / Failed Jobs</span>
  </div>
  <div class="col">
    <span class="measure">{{if measures.total measures.avgs.duration "N/A"}}</span>
    <br>
    <span class="title">Avg. Build Time</span>
  </div>
  <div class="col">
    <span class="measure">{{if measures.total measures.avgs.imagePullTime "N/A"}}</span>
    <br>
    <span class="title">Avg. Image Pull Time</span>
  </div>
  <div class="col">
    <span class="measure">{{if measures.total measures.avgs.queuedTime "N/A"}}</span>
    <br>
    <span class="title">Avg. Queued Time</span>
  </div>
</div>

{{#if measures.total}}
  {{log this.downtimeJobsLegends}}

  <Metrics::Chart
    @chartTitle="Downtime Metrics"
    @eventsChartName="downtimeMetrics"
    @legends={{this.downtimeJobsLegends}}
    @onLegendClick={{action "onLegendClick"}}
    @onLegendHover={{action "onLegendHover"}}
    @onLegendHoverOut={{action 'onLegendHoverOut'}}

    @name="downtimeMetrics"
    @data={{this.eventMetrics}}
    @axis={{this.eventsAxis}}
    @tooltip={{this.tooltip}}
    @onrendered={{this.onrendered}}
    @onresized={{this.onresized}}
    @oninit={{get onInitFns "downtimeMetrics"}}
  />



{{else}}
  <div class="chart-cta">No metric available for the chosen time range!</div>
{{/if}}

{{outlet}}
